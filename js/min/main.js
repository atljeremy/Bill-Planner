/*
Deliverable 4
Author: Jeremy Fox
Created For: MiU Online
Simple HTML5 / Javascript Mobile Web Form
*//*
Variables
*/((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=this;this.dataViewState=!1;this.hasDataBeenDisplayed=!1;this.invalidateData=!1;this.keyToEdit=0;b=["Please Select An Account","Bank of America - Checking","Bank of America - Savings","Bank of America - Credit Card"];this.detailsKey="";u=function(a){return G.dataViewState=a};n=function(){return G.dataViewState};r=function(a){return G.hasDataBeenDisplayed=a};j=function(){return G.hasDataBeenDisplayed};t=function(a){return G.invalidateData=a};m=function(){return G.invalidateData};e=function(){return $("#items").empty()};f=function(){return $("#itemDetails").empty()};this.getKeyToEdit=function(){return G.keyToEdit};this.setKeyToEdit=function(a){return G.keyToEdit=a};s=function(a){return G.detailsKey=a};k=function(){return G.detailsKey};this.storeData=function(){var a,b,c;c=new Date;G.getKeyToEdit()===0||G.getKeyToEdit()===""?b=c.getTime():b=G.getKeyToEdit();a={};a.name=["Name:",$("#name").val()];a.payto=["Pay To:",$("#payTo").val()];a.amount=["Amount:",$("#payAmount").val()];a.account=["From Account:",$("#payFrom").val()];a.payon=["Pay On:",$("#payOn").val()];a.notes=["Notes:",$("#notes").val()];a.remember=["Remember This Payment:",l()];try{localStorage.setItem(b,JSON.stringify(a));t(!0);alert("Bill Added!");G.setKeyToEdit(0);$("legend").html("<h2>Create a New Bill</h2>");G.displayData()}catch(d){return alert(d)}};$(window).scroll(function(){if($(window).scrollTop()>=$(document).height()-$(window).height()-100){$("div#loadmoreajaxloader").show();return $.ajax({type:"POST",url:"php/load_bills.php",success:function(a){return n()?a?A(a):$("div#loadmoreajaxloader").hide():$("div#loadmoreajaxloader").hide()}})}});A=function(a){_.each(_.keys(a),function(b){var c;c=b;return _.each(_.keys(a[b]),function(b){var d,e;e=a[c];d=e[b];try{localStorage.setItem(b,JSON.stringify(d));return!0}catch(f){return alert(f)}})});t(!0);$("div#loadmoreajaxloader").hide();return i()};z=function(){_.each(_.keys(G.json),function(a){var b;b=this.json[a];try{localStorage.setItem(a,JSON.stringify(b))}catch(c){return alert(c)}});t(!0);return i()};i=function(){return _.size(localStorage)>0?q(localStorage,"localStorage"):z()};v=function(){var a,b;a=[];_.each(_.keys(localStorage),function(b){var c,d;d=localStorage.getItem(b);c=JSON.parse(d);c.key=b;return a.push(c)});b=function(a,b){return a.payon[1]===b.payon[1]?a.payon[1]===b.payon[1]?0:a.payon[1]<b.payon[1]?-1:1:a.payon[1]<b.payon[1]?-1:1};return a.sort(b)};q=function(){var a;a=1;return _.each(v(),function(b){var c,d,e,f,g,h,i,j,k,l,m;f=b.key;i=document.createElement("li");i.setAttribute("id","li-key-"+f);j=document.createElement("img");j.setAttribute("class","listThumbIcons");c=/((Checking)|(Savings)|(Credit\sCard))+/g;d=b.account[1];e=d.match(c);console.log(e);switch(e[0]){case"Checking":j.setAttribute("src","i/checking_thumb.png");break;case"Savings":j.setAttribute("src","i/savings_thumb.png");break;case"Credit Card":j.setAttribute("src","i/credit_thumb.png");break;default:j.setAttribute("src","i/checking_thumb.png")}g=document.createElement("img");g.setAttribute("src","i/arrow.png");g.setAttribute("class","listArrowIcons");_.size(localStorage)===a?i.setAttribute("class","lastBill"):i.setAttribute("class","bill");h=document.createElement("a");h.setAttribute("href","#");i.appendChild(h);i.appendChild(j);i.appendChild(g);$("#items").append(i);$("#li-key-"+f).click("click",function(a){y(a);$(this).removeClass("bill").addClass("billClicked");s(f);$.mobile.changePage("details.html",{showLoadMsg:!0});return!1});m=b.payto[1];m.length>=20&&(m=m.substr(0,20)+"â€¦");k="$"+b.amount[1];l="("+b.payon[1]+")";h.innerHTML=m+" "+k+" "+l;return a++})};g=function(a){var b,c,d,e,f,g;e=localStorage.getItem(a);b=JSON.parse(e);G.setKeyToEdit(a);$("legend").html('<h2>Your Editing a Bill - <a href="#" id="cancelEdit" data-ajax="false" >Cancel</a></h2>');$("#cancelEdit").click("click",function(a){return $.mobile.changePage("additem.html",{reloadPage:!0,allowSamePageTranstion:!0,transition:"slide"})});document.getElementById("name").value=b.name[1];document.getElementById("payTo").value=b.payto[1];document.getElementById("payAmount").value=b.amount[1];document.getElementById("payFrom").value=b.account[1];document.getElementById("payOn").value=b.payon[1];document.getElementById("notes").value=b.notes[1];d=$("input[type='radio']");for(f=0,g=d.length;f<g;f++){c=d[f];if(c.value==="Yes"&&b.remember[1]==="Yes"){c.setAttribute("checked","checked");document.getElementById("labelNo").setAttribute("class","ui-btn ui-corner-right ui-controlgroup-last ui-radio-off ui-btn-up-c");document.getElementById("labelYes").setAttribute("class","ui-btn ui-corner-left ui-btn-up-c ui-radio-on ui-btn-active")}else if(c.value==="No"&&b.remember[1]==="No"){c.setAttribute("checked","checked");document.getElementById("labelYes").setAttribute("class","ui-btn ui-radio-off ui-corner-left ui-btn-up-c");document.getElementById("labelNo").setAttribute("class","ui-btn ui-corner-right ui-controlgroup-last ui-radio-on ui-btn-active ui-btn-up-c")}}history.back();return setTimeout(function(){return this.displayData()},500)};d=function(a){var b;b=confirm("Are you sure you want to delete this bill?");if(b){$("#bill-"+a).animate({opacity:0,height:"toggle"},1e3);setTimeout(function(){localStorage.removeItem(a);t(!0);history.back();return this.displayData(!0,!1)},1e3);return!1}};w=function(a){return $("#li-account-"+a).animate({opacity:0},500,function(){return $("#li-account-"+a).animate({opacity:1},500,function(){})})};this.addAccount=function(a){};this.clearStorage=function(){localStorage.clear();return alert("All Data Has Been Deleted.")};$("#billForm").live("submit",function(a){var b;y(a);if($("#billForm").valid()){b=$(this).serialize();$.ajax({type:"POST",url:"http://strong-samurai-1042.herokuapp.com/api/add",data:b,success:function(a){alert("done!");console.log(a);return storeData()}})}else $("html, body").animate({scrollTop:0},0);return!1});$("#billSearch").click("click",function(a){$("#searchFormContainer").css("display","block");$("#searchFormContainer").animate({opacity:1},1e3);$("#billSearch").animate({opacity:0},500);setTimeout(function(){return $("#billSearch").css("display","none")},500);return setTimeout(function(){$("#billSearchHide").css("display","inline");return $("#billSearchHide").animate({opacity:1},500)},500)});$("#billSearchHide").click("click",function(a){$("#searchFormContainer").animate({opacity:0},1e3);setTimeout(function(){return $("#searchFormContainer").css("display","none")},1e3);$("#billSearchHide").animate({opacity:0},500);setTimeout(function(){return $("#billSearchHide").css("display","none")},500);return setTimeout(function(){$("#billSearch").css("display","inline");return $("#billSearch").animate({opacity:1},500)},500)});$("#viewBills").click("click",function(a){y(a);setTimeout(function(){return this.displayData(!0,!1)},700);return $.mobile.changePage("additem.html",{transition:"slideup",showLoadMsg:!0})});$("#accounts").click("click",function(a){y(a);return $.mobile.changePage("accounts.html",{showLoadMsg:!0})});$("#faq").click("click",function(a){y(a);return $.mobile.changePage("faq.html",{showLoadMsg:!0})});$("#addBill").click("click",function(a){y(a);setTimeout(function(){return this.displayData(!1,!0)},500);return $.mobile.changePage("additem.html",{showLoadMsg:!0})});$("#cta-bills").click("click",function(a){y(a);setTimeout(function(){return this.displayData(!1,!0)},500);return $.mobile.changePage("additem.html",{showLoadMsg:!0})});$("#searchForm").submit(function(a){y(a);setTimeout(function(){return this.displayData(!0,!1)},500);$.mobile.changePage("additem.html",{showLoadMsg:!0});return!1});a=function(a){return a<10?"0"+a:""+a};l=function(){var a,b,c,d,e;b=$("input[type='radio']");for(d=0,e=b.length;d<e;d++){a=b[d];if(a.checked){c="";c=a.value;return c}}};D=function(){var a;a=[];($("#name").val()===null||$("#name").val()==="")&&a.push("Please Enter Your Name.");($("#payTo").val()===null||$("#payTo").val()==="")&&a.push("Please Enter Who You Would Like To Pay.");($("#payAmount").val()===null||$("#payAmount").val()===0)&&a.push("Please Enter The Amount To Pay.");($("#payFrom").val()===null||$("#payFrom").val()===""||$("#payFrom").val()==="-- Choose Account --")&&a.push("Please Enter The Account To Pay From.");($("#payOn").val()===null||$("#payOn").val()==="")&&a.push("Please Enter The Date You Would Like To Make This Payment.");C($("#payOn").val())&&a.push("Please Enter A Valid Date.");return a};C=function(b){var c,d,e,f,g,h,i,j;g=!1;c=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/;h=b.match(c);h.length<=0&&(g=!0);d=new Date;i="";i=d.getMonth()+1;f="";f=d.getDate();j="";j=d.getFullYear();e=_.toArray(b.split("-"));if(e[0]<j){g=!0;console.log("Entered Year ="+e[0]+". Current Year ="+j)}if(e[1]<a(i)){g=!0;console.log("Entered Month ="+e[1]+". Current Month ="+a(i))}if(e[2]<a(f)&&e[1]===a(i)){g=!0;console.log("Entered Day ="+e[2]+". Current Day ="+a(f))}return g!==null||g!==""&&_.isBoolean(g)?g:alert("ERROR: Please Try Again.")};y=function(a){a.preventDefault();a.stopPropagation();if($.browser.msie){a.originalEvent.keyCode=0;a.originalEvent.cancelBubble=!0;return a.originalEvent.returnValue=!1}};F=function(){$("#itemsSection").css("display","inline-block")};p=function(){$("#itemsSection").css("display","none")};E=function(){$("#billForm").css("display","inline")};o=function(){$("#billForm").css("display","none")};this.displayData=function(a,b){var c,d;c=a!==null||a!==""?a:!1;d=b!==null||b!==""?b:!1;d?G.showForm():c?G.showBills():n()?G.showForm():G.showBills()};this.showForm=function(){u(!1);p();E();$("#displayData").text("Display Data");$("#displayData").css("padding","0.65em 15px 0.6em 15px")};this.showBills=function(){u(!0);o();F();if(j()===!1||m()){e();i();r(!0);t(!1)}$("#displayData").text("Display Form");$("#displayData").css("padding","0.65em 15px 0.6em 15px")};B=function(){return $(document).unbind("click")};this.actBank=function(){console.log($("#accountBank").val());return $("#accountBank").val()!==null&&$("#accountBank").val()!==""?$("#actType").removeClass("hide").addClass("show"):alert("Please enter your bank account to conitue.")};this.actType=function(){console.log($("#accountType").val());if($("#accountType").val()!==null&&$("#accountType").val()!==""){if($("#accountType").val()==="credit")return $("#actExp").removeClass("hide").addClass("show");$("#actExp").removeClass("show").addClass("hide");return $("#actNum").removeClass("hide").addClass("show")}return alert("Please enter the account type to conitue.")};this.actExp=function(){console.log($("#accountExpiration").val());return $("#accountExpiration").val()!==null&&$("#accountExpiration").val()!==""?$("#actNum").removeClass("hide").addClass("show"):alert("Please enter your credit cards expiration date to conitue.")};this.actNum=function(){console.log($("#accountNumber").val());return $("#accountNumber").val()!==null&&$("#accountNumber").val()!==""?$("#accountSubmitBtn").removeClass("hide").addClass("show"):alert("Please enter your credit cards expiration date to conitue.")};$("#accountForm").live("submit",function(a){var b;y(a);b=$(this).serialize();return $.ajax({type:"POST",url:"accounts.html",data:b,success:function(){return alert("Your account has been added! --THIS IS NOT ACTUALLING DOING ANYTHING JUST YET!--")}})});$(document).bind("mobileinit",function(){$.mobile.accounts=h;$.mobile.date=c;$.mobile.details=x});h=function(){var a,c,d,e,f,g;c=document.getElementById("selectAccounts");e=document.createElement("select");e.setAttribute("id","payFrom");e.setAttribute("class","required");for(f=0,g=b.length;f<g;f++){a=b[f];d=document.createElement("option");d.setAttribute("value",a);d.innerHTML=a;e.appendChild(d)}c.appendChild(e)};c=function(){var b,c,d,e,f;b=new Date;d=b.getMonth()+1;c=b.getDate();f=b.getFullYear();e=f+"-"+a(d)+"-"+a(c);return document.getElementById("payOn").value=e};x=function(a){var b,c,e,h,i,j,l,m,n,o,p;$("#backToBills").click("click",function(b){y(b);history.back();return $("#li-key-"+a).removeClass("billClick").addClass("bill")});a=a!==void 0?a:k();f();m=document.createElement("ul");$("#itemDetails").append(m);n=document.createElement("li");m.appendChild(n);p=localStorage[a];h=JSON.parse(p);o=document.createElement("ul");o.setAttribute("id","bill-"+a);l=document.createElement("img");l.setAttribute("src","i/pencil.png");l.setAttribute("class","icons");l.setAttribute("id","edit-"+a);j=document.createElement("img");j.setAttribute("src","i/x.png");j.setAttribute("class","icons");j.setAttribute("id","delete-"+a);i=document.createElement("img");b=/((Checking)|(Savings)|(Credit\sCard))+/g;c=h.account[1];e=c!=null?c.match(b):"Undefined";switch(e[0]){case"Checking":i.setAttribute("src","i/thumb_checking.png");break;case"Savings":i.setAttribute("src","i/thumb_savings.png");break;case"Credit Card":i.setAttribute("src","i/thumb_creditcard.png");break;case"Undefined":i.setAttribute("src","i/thumb_checking.png")}i.setAttribute("class","icons");i.setAttribute("id","account-"+a);o.appendChild(l);o.appendChild(j);o.appendChild(i);n.appendChild(o);$("#edit-"+a).click("click",function(b){return g(a)});$("#delete-"+a).click("click",function(b){return d(a)});$("#account-"+a).click("click",function(b){return w(a)});_.each(h,function(b){var c,d;d=document.createElement("li");b[0]==="From Account:"&&d.setAttribute("id","li-account-"+a);o.appendChild(d);c=document.createElement("span");p=document.createElement("span");c.setAttribute("class","billField");p.setAttribute("class","billValue");d.appendChild(c);d.appendChild(p);c.innerHTML=b[0]+" ";p.innerHTML=b[1];return!0});return!0}})).call(this);